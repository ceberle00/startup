'use strict'
//const localStorage = global.localStorage
//  ? global.localStorage
 // : new (require('node-localstorage').LocalStorage)('./store')
const db = require("quick.db")
class LocalStorageExp {
  /**
   * @param {string} key - name of key
   * @param {Object} jsonData - value to save
   * @param {Number} expirationMin - integer with time of expire in minute
   */
  save (key, jsonData, expirationMin) {
    const data = await Schema.findOne({key: key})
    if(data) await Schema.findOneAndDelete({key: key})
    const expirationMS = expirationMin * 60 * 1000
    const record = {
      value: JSON.stringify(jsonData),
      timestamp: new Date().getTime() + expirationMS
    }
    db.set(key, JSON.stringify(record))

   // localStorage.setItem(key, JSON.stringify(record))
  }

  /**
   * @param {string} key - name of key
   */
  load (key) {
     //const record = JSON.parse(localStorage.getItem(key))
     const record = JSON.parse(db.get(key))
    if (!data) { return false }
    return (new Date().getTime() < record.timestamp && JSON.parse(record.value))
  }

  /**
   * @param {string} key - name of key
   */
  remove (key) {
    //localStorage.removeItem(key)
    db.delete(key)
  }
}

module.exports = new LocalStorageExp()
